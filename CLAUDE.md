# CLAUDE.md

이 파일은 이 저장소에서 코드 작업 시 Claude Code (claude.ai/code)에게 가이드를 제공합니다.

## 프로젝트 개요
실시간 채팅, Amazon IVS 통합, 사용자 관리, 방송 도구를 갖춘 Next.js 15 라이브 스트리밍 플랫폼. 포괄적인 역할 기반 접근 제어와 Socket.IO 실시간 기능을 제공합니다.

## 개발 명령어
```bash
npm run dev    # 개발 서버 (포트 8888)
npm run build  # 프로덕션 빌드
npm start      # 프로덕션 서버 (포트 80)  
npm run lint   # ESLint 검사
```

## 아키텍처 개요

### API 레이어 (`app/_apis/`)
- **자동 갱신 인증**: JWT 토큰과 axios 인터셉터를 통한 자동 갱신 처리
- **모듈형 구조**: 도메인별 API 분리 (user, live, IVS, posts, manager)
- **쿠키 기반 세션**: 지속적인 인증을 위한 `withCredentials: true`
- **중앙집중식 에러 처리**: 모든 API에서 일관된 에러 메시지 추출

### 상태 관리 (Zustand)
- `userStore` - 인증 및 프로필 상태
- `modalStore` - 전역 모달 관리 (로그인, 에러, 팝업, 사용자 액션)
- `playStore` - 라이브 스트리밍 재생 상태
- `errorModalStore` - 에러 처리 및 표시

### 컴포넌트 아키텍처
**기능 기반 구조:**
```
_components/
├── live/           # 스트리밍 핵심 (IVS 플레이어, 채팅, 시청자 관리)
├── channel/        # 관리 도구 (블랙리스트, 팬 등급, 방송 설정)
├── modals/         # 다양한 타입의 전역 모달 시스템
└── utils/store/    # Zustand 상태 관리
```

### 실시간 기능 (Socket.IO)
- **이중 인증**: HTTP + Socket JWT 토큰 관리
- **역할 기반 채팅**: 방송자 > 매니저 > 시청자 > 게스트 계층
- **실시간 업데이트**: 시청자 수, 사용자 액션, 스트림 이벤트
- **연결 관리**: 중복 세션 방지

### Amazon IVS 통합
- **플레이어 컨트롤**: 품질/볼륨 관리가 가능한 커스텀 비디오 플레이어
- **스트림 관리**: 방송 키, 프라이버시 설정, 분석
- **에러 처리**: 플레이어 상태 관리 및 에러 복구

## 주요 패턴

### 인증 플로우
1. 로그인 시 HTTP 세션 + JWT 토큰 생성
2. 실시간 기능을 위해 JWT를 사용하여 Socket.IO 연결
3. 자동 갱신으로 세션 연속성 유지
4. 사용자 권한에 따른 역할 기반 UI/기능

### 모달 시스템
- `modalStore`에서 중앙집중식 모달 상태 관리
- 다양한 모달 타입: 로그인, 에러, 팝업, 사용자 액션
- 에러 경계가 사용자 피드백을 위해 `errorModalStore`로 연결

### 테마 시스템
- CSS 커스텀 속성을 사용한 다크/라이트 모드
- Tailwind 설정에 정의된 포괄적인 색상 시스템
- `next-themes`를 통한 테마 지속성

### 컴포넌트 구성
- 복잡한 기능을 위한 복합 컴포넌트 (블랙리스트 관리, 팬 등급)
- 비즈니스 로직을 위한 커스텀 훅 (`useChatSocket`, `useUserActions`)
- 재사용 가능한 컴포넌트를 위한 prop 기반 커스터마이징

## 개발 워크플로우

### 새로운 기능 추가
1. `app/_types/[feature].ts`에서 타입 정의
2. `app/_apis/[feature].ts`에서 API 함수 생성
3. `app/_components/[feature]/`에서 컴포넌트 구축
4. 적절한 `app/[route]/page.tsx`에서 라우트 추가
5. 전역 상태가 필요한 경우 Zustand 스토어 업데이트

### 실시간 기능
- 채팅 타입에 정의된 Socket 이벤트
- 채팅 컴포넌트에서 역할 기반 메시지 필터링
- 소켓 관리를 위한 `useChatSocket` 훅 사용
- 연결 상태 및 중복 세션 처리

### 스타일링 접근법
- 일관된 간격/색상을 위한 Tailwind 유틸리티 클래스
- 테마 변수를 위한 CSS 커스텀 속성
- 필요시 컴포넌트 범위 스타일
- 모바일 우선 반응형 디자인

## 중요 고려사항

### 사용자 역할 및 권한
- 방송자: 완전한 채널 제어
- 매니저: 중재 기능
- 시청자: 표준 사용자 기능
- 게스트: 제한된 익명 접근

### 에러 처리
- axios 인터셉터로 API 에러 처리
- 에러 경계로 UI 에러 포착
- 에러 모달 시스템을 통한 사용자 피드백
- 더 나은 UX를 위한 로딩 상태

### 성능
- 최적의 번들 분할을 위한 Next.js App Router
- 하드웨어 가속 비디오를 위한 Amazon IVS
- Next.js Image 컴포넌트를 통한 이미지 최적화
- 경량 상태 관리를 위한 Zustand